<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="{lang:}">
  <head>
    <title>RSpec.info: Method Stubs</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="RSpec, {title: }, BDD, behaviour driven development, behavior driven development, TDD, test driven development, Ruby, Rails, testing, watir, selenium"/>

    <!-- CodeRay syntax highlighting CSS -->
    <link rel="stylesheet" href="/rspec-1-3-2-info/css/coderay.css" type="text/css" />

    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/rspec-1-3-2-info/css/breadcrumbs.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="/rspec-1-3-2-info/css/default.css" type="text/css" media="screen, projection" />

    <style><!--
    div.breadcrumbs ul li {
    	background-image: url(/images/arrow.gif);
    }
    --></style>
  </head>
<body>

<div id="container">
  <div id="header">
    <h1><a href="/rspec-1-3-2info/">rspec-1.3.2 | rspec-rails-1.3.4</a></h1>
  </div>

  <div class="breadcrumb-menu">      <div class="breadcrumbs">
        <ul>
        
          
            <li><a href="/rspec-1-3-2-info/">Home</a></li>
          
        
          
            <li><a href="/rspec-1-3-2-info/documentation/">RSpec</a></li>
          
        
          
            <li><a href="/rspec-1-3-2-info/documentation/mocks/">Mocks and Stubs</a></li>
          
        
          
            <li class="current"><a href="/rspec-1-3-2-info/documentation/mocks/stubs.html">Method Stubs</a></li>
          
        
        </ul>
      </div>
      <div class="menu">
        <ul>
        
        
        
                </ul>
      </div>
</div>

  <div id="content">
    <h2>Method Stubs</h2>
<p>A method stub is an implementation of a method that returns a canned response.</p>
<p>The main difference between a method stub and a <a href="message_expectations.html">message expectation</a> is that message expectations verify interactions that you expect, while method stubs just sit there and return values.</p>
<h3>Setting an explicit return value</h3>
<p>This is the simplest (and recommended) approach to stubbing.</p>
<div class="CodeRay">
<pre>my_instance.stub!(<span class="sy">:msg</span>).and_return(value)
<span class="co">MyClass</span>.stub!(<span class="sy">:msg</span>).and_return(value)
</pre>
</div>
<h3>Calculating a return value</h3>
<div class="CodeRay">
<pre>my_instance.stub!(<span class="sy">:msg</span>).and_return { ... }
<span class="co">MyClass</span>.stub!(<span class="sy">:msg</span>).and_return { ... }
</pre>
</div>
<p>While this is possible, it is generally to be avoided. Calculating a value to return defeats the declarative nature of stubs.</p>
<h3>Multiple return values</h3>
<div class="CodeRay">
<pre>my_instance.stub!(<span class="sy">:msg</span>).and_return(<span class="s"><span class="dl">&quot;</span><span class="k">1</span><span class="dl">&quot;</span></span>,<span class="i">2</span>)
<span class="co">MyClass</span>.stub!(<span class="sy">:msg</span>).and_return(<span class="s"><span class="dl">&quot;</span><span class="k">1</span><span class="dl">&quot;</span></span>,<span class="i">2</span>)
</pre>
</div>
<p>This will return &#8220;1&#8221; the first time it is called and 2 every subsequent call. Like calculated return values, this is a little un-stubby, but it can be a handy feature once in a while.</p>
<h3>Mixing method stubs and message expectations</h3>
<p>In some cases it can be helpful to stub a default return value, but set a message expectation for a specific set of args. For example:</p>
<div class="CodeRay">
<pre><span class="co">A</span>.stub!(<span class="sy">:msg</span>).and_return(<span class="sy">:default_value</span>)
<span class="co">A</span>.should_receive(<span class="sy">:msg</span>).with(<span class="sy">:arg</span>).and_return(<span class="sy">:special_value</span>)
<span class="co">A</span>.msg
=&gt; <span class="sy">:default_value</span>
<span class="co">A</span>.msg(<span class="sy">:any_other_arg</span>)
=&gt; <span class="sy">:default_value</span>
<span class="co">A</span>.msg(<span class="sy">:arg</span>)
=&gt; <span class="sy">:special_value</span>
<span class="co">A</span>.msg(<span class="sy">:any_other_other_arg</span>)
=&gt; <span class="sy">:default_value</span>
<span class="co">A</span>.msg
=&gt; <span class="sy">:default_value</span>
</pre>
</div>
    
    <div id="footer">
      Webdesign by <a href="http://www.oswd.org/user/profile/id/9462">JM</a>
      <SCRIPT type='text/javascript' language='JavaScript' src='https://www.ohloh.net/projects/4386;badge_js'></SCRIPT>
    </div>
  </div>
</div>

<script src="https://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1889510-1";
urchinTracker();
</script>
</body>
</html>
